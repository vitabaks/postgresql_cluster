---
# üöÄ These tasks aim to test the haproxy_nodes variable
# üéØ The objective is to guarantee that the list of nodes is correctly set

# ========================================
# üíª Start haproxy_nodes Operations and Tests
# ========================================

# üìù Establishing test data for haproxy_nodes
- name: Molecule.tests.variables.asserts.haproxy_nodes | Establish haproxy_nodes Test Data
  ansible.builtin.set_fact:
    haproxy_nodes: >-
      {{ 
        groups['balancers'] 
        | default([]) 
        | map('extract', hostvars, 'inventory_hostname') 
        | join(',')
      }}

# üñ®Ô∏è Debugging the established haproxy_nodes
- name: Molecule.tests.variables.asserts.haproxy_nodes | Debug haproxy_nodes
  ansible.builtin.debug:
    var: haproxy_nodes

# ‚úÖ Verifying the correctness of the established haproxy_nodes
# If the haproxy_nodes is not set, the test fails and an error message is displayed
- name: Molecule.tests.variables.asserts.haproxy_nodes | Verify haproxy_nodes
  ansible.builtin.assert:
    that:
      - "haproxy_nodes is not none"
      - "haproxy_nodes != 'N/A'"
      - "haproxy_nodes == '10.172.0.20,10.172.0.21,10.172.0.22'"
    fail_msg: "Test failed: haproxy_nodes is not set correctly."
    success_msg: "Test passed: haproxy_nodes is set correctly."
